<!doctype html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Referral</title><link rel="stylesheet" href="css/style.css"></head>
<body>
  <div class="app"><div class="container">
    <div class="header"><div class="logo">Referral</div><div><a href="dashboard.html" class="button btn-ghost">Back</a></div></div>
    <div class="card center">
      <p class="small">Your referral link</p>
      <input id="refLink" class="input" readonly />
      <button id="copyRef" class="button btn-primary">Copy Link</button>
      <p class="small" style="margin-top:8px">Referral bonus: <strong>$0.005</strong> (both sides)</p>
    </div>
  </div></div>

  <script type="module">
    import { getDoc, doc } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js';
    import { db } from './js/firebase-init.js';
    async function init(){
      const uid = localStorage.getItem('uid'); if(!uid){ location.href='login.html'; return; }
      const udoc = await getDoc(doc(db,'users',uid));
      const code = udoc.data().referralCode || uid.slice(0,6);
      const link = `${location.origin}/register.html?ref=${code}`;
      document.getElementById('refLink').value = link;
      document.getElementById('copyRef').addEventListener('click', ()=>{ navigator.clipboard.writeText(link); alert('Copied'); });
    }
    init();
  </script>
</body>
</html>
