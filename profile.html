<!doctype html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Profile</title><link rel="stylesheet" href="css/style.css"></head>
<body>
  <div class="app"><div class="container">
    <div class="header"><div class="logo">Profile</div><div><a href="dashboard.html" class="button btn-ghost">Back</a></div></div>
    <div class="card">
      <input id="p_username" class="input" placeholder="Username" />
      <input id="p_email" class="input" placeholder="Email" readonly />
      <input id="p_ton" class="input" placeholder="TON Address (save for withdraw)" />
      <button id="saveProfile" class="button btn-primary">Save</button>
      <p id="p_status" class="small" style="margin-top:8px"></p>
    </div>
  </div></div>

  <script type="module">
    import { db, ref, get, update } from './js/firebase.js';

    async function init(){
      const uid = localStorage.getItem('uid'); if(!uid) { location.href='login.html'; return; }
      const uSnap = await get(ref(db,`users/${uid}`));
      if(!uSnap.exists()) return alert('User not found');
      const data = uSnap.val();
      document.getElementById('p_username').value = data.username || '';
      document.getElementById('p_email').value = data.email || '';
      document.getElementById('p_ton').value = data.tonAddress || '';
      document.getElementById('saveProfile').addEventListener('click', async ()=>{
        await update(ref(db,`users/${uid}`), { username: document.getElementById('p_username').value.trim(), tonAddress: document.getElementById('p_ton').value.trim() });
        document.getElementById('p_status').innerText = 'Saved.';
      });
    }
    init();
  </script>
</body>
</html>
